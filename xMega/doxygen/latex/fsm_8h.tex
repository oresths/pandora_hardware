\hypertarget{fsm_8h}{\section{include/fsm.h File Reference}
\label{fsm_8h}\index{include/fsm.\-h@{include/fsm.\-h}}
}


System F\-S\-M services Header file.  


{\ttfamily \#include $<$stdint.\-h$>$}\\*
{\ttfamily \#include \char`\"{}system.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}sensors.\-h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}pc\-Interface.\-h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{fsm_8h_a2ab1ef876e06978f100f2b7153ef7db0}{\#define {\bfseries Tick200us}~0x01}\label{fsm_8h_a2ab1ef876e06978f100f2b7153ef7db0}

\item 
\hypertarget{fsm_8h_aff1e6815fe61c644250592691c74304f}{\#define {\bfseries Tick400us}~0x02}\label{fsm_8h_aff1e6815fe61c644250592691c74304f}

\item 
\hypertarget{fsm_8h_adc7214bfcd279ead9cf66e8eebd267bb}{\#define {\bfseries Tick1ms}~0x04}\label{fsm_8h_adc7214bfcd279ead9cf66e8eebd267bb}

\item 
\hypertarget{fsm_8h_ab2eb518e8f74ddb36cc55472b6464439}{\#define {\bfseries Tick200ms}~0x08}\label{fsm_8h_ab2eb518e8f74ddb36cc55472b6464439}

\item 
\hypertarget{fsm_8h_a187e4b531b84c475d3e5f76ba4625fd4}{\#define {\bfseries Tick5ms}~0x10}\label{fsm_8h_a187e4b531b84c475d3e5f76ba4625fd4}

\item 
\hypertarget{fsm_8h_a5d13fa7deebc0eda5a3474053c5026d4}{\#define {\bfseries Tick10ms}~0x20}\label{fsm_8h_a5d13fa7deebc0eda5a3474053c5026d4}

\item 
\hypertarget{fsm_8h_ad21a003fe03512e8f233d9ca0a0582fc}{\#define {\bfseries Tick50ms}~0x40}\label{fsm_8h_ad21a003fe03512e8f233d9ca0a0582fc}

\item 
\hypertarget{fsm_8h_af03ae21ade4f13b0d33bbf5ffab0a637}{\#define {\bfseries Tick100ms}~0x80}\label{fsm_8h_af03ae21ade4f13b0d33bbf5ffab0a637}

\item 
\#define \hyperlink{fsm_8h_a84156bc3e32bab24284507d83a303031}{T\-W\-I\-Watchdog\-Time\-Out}~500
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
uint8\-\_\-t \hyperlink{fsm_8h_adbf215cc37ab53e94b251cb02ce51293}{Set\-Sensor\-In\-Revive\-State} (uint8\-\_\-t Sensor\-Number)
\item 
uint8\-\_\-t \hyperlink{fsm_8h_ac6c8493b0fea9a14fdba8a3473d7cc12}{I2\-C\-Sensor\-F\-S\-M\-Core} (uint8\-\_\-t Sensor\-Number)
\item 
uint8\-\_\-t \hyperlink{fsm_8h_a35558d664e075ee8731ff9268d8f8b6d}{S\-R\-F05tiny\-F\-S\-M} (uint8\-\_\-t Sensor\-Number)
\item 
void \hyperlink{fsm_8h_a0fcf5e90554fb79bfa792eb110ed1fe1}{Wait\-I2\-C\-Status} (uint8\-\_\-t Sensor\-Number)
\item 
uint8\-\_\-t \hyperlink{fsm_8h_a22e3e2f52a53eff2ec1465883753db1d}{T\-W\-I\-Result\-Handler} (uint8\-\_\-t Sensor\-Number)
\item 
void \hyperlink{fsm_8h_ad040d5fa41e6f301ac09295e9cf7aaef}{Sensor\-Wait\-Time\-Handler} (void)
\item 
\hypertarget{fsm_8h_a0c99bbf1c5bc978d299264929a8888d2}{void {\bfseries T\-W\-I\-Watchdog} (void)}\label{fsm_8h_a0c99bbf1c5bc978d299264929a8888d2}

\item 
\hypertarget{fsm_8h_aec5800535c3b5f0ed07aa21a660eaf2f}{void {\bfseries Group\-Handler} (void)}\label{fsm_8h_aec5800535c3b5f0ed07aa21a660eaf2f}

\item 
void \hyperlink{fsm_8h_a05b49f5eb1da9dd701624310ae83e520}{Create\-Array\-Same\-Group\-I\-Ds} (void)
\item 
\hypertarget{fsm_8h_a34b59de2fc1e23b5dcb24e9e5c9cfb08}{uint8\-\_\-t {\bfseries Find\-First\-Available\-Sensor} (uint8\-\_\-t Sensor\-Number)}\label{fsm_8h_a34b59de2fc1e23b5dcb24e9e5c9cfb08}

\item 
\hypertarget{fsm_8h_a5165e2a9c796a4999d3633b9e0eab64d}{void {\bfseries pandora\-\_\-fsm} (void)}\label{fsm_8h_a5165e2a9c796a4999d3633b9e0eab64d}

\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{fsm_8h_a37799ac9eeb22510b02859242d5f16d1}{volatile uint8\-\_\-t {\bfseries Current\-Group}}\label{fsm_8h_a37799ac9eeb22510b02859242d5f16d1}

\item 
\hypertarget{fsm_8h_a671d38ebf3542cd8eca5f72d7459694b}{volatile uint16\-\_\-t {\bfseries ticks}}\label{fsm_8h_a671d38ebf3542cd8eca5f72d7459694b}

\item 
\hypertarget{fsm_8h_a8711919036a8d8abb73341cb5dcc98d0}{volatile uint8\-\_\-t {\bfseries T\-C\-Timing\-Flags}}\label{fsm_8h_a8711919036a8d8abb73341cb5dcc98d0}

\item 
\hypertarget{fsm_8h_a9b9648b0d6028cfce122aabac7fe9134}{volatile uint8\-\_\-t {\bfseries Next\-Sensor}}\label{fsm_8h_a9b9648b0d6028cfce122aabac7fe9134}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
System F\-S\-M services Header file. Created\-: 5/9/2014 8\-:27\-:15 P\-M Author\-: dikan / Panayiotou Konstantinos Email\-: \href{mailto:glagloui@gmail.com}{\tt glagloui@gmail.\-com} 

\subsection{Macro Definition Documentation}
\hypertarget{fsm_8h_a84156bc3e32bab24284507d83a303031}{\index{fsm.\-h@{fsm.\-h}!T\-W\-I\-Watchdog\-Time\-Out@{T\-W\-I\-Watchdog\-Time\-Out}}
\index{T\-W\-I\-Watchdog\-Time\-Out@{T\-W\-I\-Watchdog\-Time\-Out}!fsm.h@{fsm.\-h}}
\subsubsection[{T\-W\-I\-Watchdog\-Time\-Out}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\-W\-I\-Watchdog\-Time\-Out~500}}\label{fsm_8h_a84156bc3e32bab24284507d83a303031}


\subsection{Function Documentation}
\hypertarget{fsm_8h_a05b49f5eb1da9dd701624310ae83e520}{\index{fsm.\-h@{fsm.\-h}!Create\-Array\-Same\-Group\-I\-Ds@{Create\-Array\-Same\-Group\-I\-Ds}}
\index{Create\-Array\-Same\-Group\-I\-Ds@{Create\-Array\-Same\-Group\-I\-Ds}!fsm.h@{fsm.\-h}}
\subsubsection[{Create\-Array\-Same\-Group\-I\-Ds}]{\setlength{\rightskip}{0pt plus 5cm}void Create\-Array\-Same\-Group\-I\-Ds (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{fsm_8h_a05b49f5eb1da9dd701624310ae83e520}
$<$Brief function description \begin{DoxyVerb}   Create an array with the IDs of sensors that belong in CurrentGroup (this group will begin measurements) 
   and clear 'Used' flag of Sensors in this group.\end{DoxyVerb}
 Brief function description \begin{DoxyVerb}   Select next available sensor to be serviced on I2C bus.\end{DoxyVerb}
 \hypertarget{fsm_8h_ac6c8493b0fea9a14fdba8a3473d7cc12}{\index{fsm.\-h@{fsm.\-h}!I2\-C\-Sensor\-F\-S\-M\-Core@{I2\-C\-Sensor\-F\-S\-M\-Core}}
\index{I2\-C\-Sensor\-F\-S\-M\-Core@{I2\-C\-Sensor\-F\-S\-M\-Core}!fsm.h@{fsm.\-h}}
\subsubsection[{I2\-C\-Sensor\-F\-S\-M\-Core}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t I2\-C\-Sensor\-F\-S\-M\-Core (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8h_ac6c8493b0fea9a14fdba8a3473d7cc12}
$<$ Brief function description \begin{DoxyVerb}   FSM core for I2C communications.
   Lasts 15usec MAX.\end{DoxyVerb}
 Brief function description \begin{DoxyVerb}   SRF05 Sonars Service FSM.\end{DoxyVerb}
 \hypertarget{fsm_8h_ad040d5fa41e6f301ac09295e9cf7aaef}{\index{fsm.\-h@{fsm.\-h}!Sensor\-Wait\-Time\-Handler@{Sensor\-Wait\-Time\-Handler}}
\index{Sensor\-Wait\-Time\-Handler@{Sensor\-Wait\-Time\-Handler}!fsm.h@{fsm.\-h}}
\subsubsection[{Sensor\-Wait\-Time\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}void Sensor\-Wait\-Time\-Handler (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{fsm_8h_ad040d5fa41e6f301ac09295e9cf7aaef}
Brief function description \begin{DoxyVerb}   Sets I2C sensor in revive state and resets I2C bus.
   Increases Communication Errors counter for the specific sensor.
   Punish that sensor on a wait state.\end{DoxyVerb}
 \hypertarget{fsm_8h_adbf215cc37ab53e94b251cb02ce51293}{\index{fsm.\-h@{fsm.\-h}!Set\-Sensor\-In\-Revive\-State@{Set\-Sensor\-In\-Revive\-State}}
\index{Set\-Sensor\-In\-Revive\-State@{Set\-Sensor\-In\-Revive\-State}!fsm.h@{fsm.\-h}}
\subsubsection[{Set\-Sensor\-In\-Revive\-State}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t Set\-Sensor\-In\-Revive\-State (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8h_adbf215cc37ab53e94b251cb02ce51293}
Brief function description \begin{DoxyVerb}   Check if all sensors in "CurrentGroup" ended measuring or are in revive state. 
   If true, initialize next group to be serviced.\end{DoxyVerb}
 \hypertarget{fsm_8h_a35558d664e075ee8731ff9268d8f8b6d}{\index{fsm.\-h@{fsm.\-h}!S\-R\-F05tiny\-F\-S\-M@{S\-R\-F05tiny\-F\-S\-M}}
\index{S\-R\-F05tiny\-F\-S\-M@{S\-R\-F05tiny\-F\-S\-M}!fsm.h@{fsm.\-h}}
\subsubsection[{S\-R\-F05tiny\-F\-S\-M}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t S\-R\-F05tiny\-F\-S\-M (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8h_a35558d664e075ee8731ff9268d8f8b6d}
Brief function description \begin{DoxyVerb}   Two Wire Interface (I2C) software watchdog.\end{DoxyVerb}
 \hypertarget{fsm_8h_a22e3e2f52a53eff2ec1465883753db1d}{\index{fsm.\-h@{fsm.\-h}!T\-W\-I\-Result\-Handler@{T\-W\-I\-Result\-Handler}}
\index{T\-W\-I\-Result\-Handler@{T\-W\-I\-Result\-Handler}!fsm.h@{fsm.\-h}}
\subsubsection[{T\-W\-I\-Result\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t T\-W\-I\-Result\-Handler (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8h_a22e3e2f52a53eff2ec1465883753db1d}
Brief function description \begin{DoxyVerb}   Handle waiting time for "punished" sensors on I2C bus
   Decrease WaitCount1/ComRepeats/TimeForNextCycle if !0 \end{DoxyVerb}
 \hypertarget{fsm_8h_a0fcf5e90554fb79bfa792eb110ed1fe1}{\index{fsm.\-h@{fsm.\-h}!Wait\-I2\-C\-Status@{Wait\-I2\-C\-Status}}
\index{Wait\-I2\-C\-Status@{Wait\-I2\-C\-Status}!fsm.h@{fsm.\-h}}
\subsubsection[{Wait\-I2\-C\-Status}]{\setlength{\rightskip}{0pt plus 5cm}void Wait\-I2\-C\-Status (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8h_a0fcf5e90554fb79bfa792eb110ed1fe1}
Brief function description \begin{DoxyVerb}   I2C bus results handler. Checks for bus errors and data transmission errors.\end{DoxyVerb}
 