\hypertarget{fsm_8c}{\section{src/fsm.c File Reference}
\label{fsm_8c}\index{src/fsm.\-c@{src/fsm.\-c}}
}


System F\-S\-M services Source file.  


{\ttfamily \#include \char`\"{}fsm.\-h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{fsm_8c_a5165e2a9c796a4999d3633b9e0eab64d}{void {\bfseries pandora\-\_\-fsm} (void)}\label{fsm_8c_a5165e2a9c796a4999d3633b9e0eab64d}

\item 
uint8\-\_\-t \hyperlink{fsm_8c_ac6c8493b0fea9a14fdba8a3473d7cc12}{I2\-C\-Sensor\-F\-S\-M\-Core} (uint8\-\_\-t Sensor\-Number)
\item 
uint8\-\_\-t \hyperlink{fsm_8c_a35558d664e075ee8731ff9268d8f8b6d}{S\-R\-F05tiny\-F\-S\-M} (uint8\-\_\-t Sensor\-Number)
\item 
\hypertarget{fsm_8c_a0c99bbf1c5bc978d299264929a8888d2}{void {\bfseries T\-W\-I\-Watchdog} (void)}\label{fsm_8c_a0c99bbf1c5bc978d299264929a8888d2}

\item 
void \hyperlink{fsm_8c_a0fcf5e90554fb79bfa792eb110ed1fe1}{Wait\-I2\-C\-Status} (uint8\-\_\-t Sensor\-Number)
\item 
uint8\-\_\-t \hyperlink{fsm_8c_a22e3e2f52a53eff2ec1465883753db1d}{T\-W\-I\-Result\-Handler} (uint8\-\_\-t Sensor\-Number)
\item 
void \hyperlink{fsm_8c_ad040d5fa41e6f301ac09295e9cf7aaef}{Sensor\-Wait\-Time\-Handler} (void)
\item 
uint8\-\_\-t \hyperlink{fsm_8c_adbf215cc37ab53e94b251cb02ce51293}{Set\-Sensor\-In\-Revive\-State} (uint8\-\_\-t Sensor\-Number)
\item 
\hypertarget{fsm_8c_aec5800535c3b5f0ed07aa21a660eaf2f}{void {\bfseries Group\-Handler} (void)}\label{fsm_8c_aec5800535c3b5f0ed07aa21a660eaf2f}

\item 
void \hyperlink{fsm_8c_a05b49f5eb1da9dd701624310ae83e520}{Create\-Array\-Same\-Group\-I\-Ds} (void)
\item 
\hypertarget{fsm_8c_a34b59de2fc1e23b5dcb24e9e5c9cfb08}{uint8\-\_\-t {\bfseries Find\-First\-Available\-Sensor} (uint8\-\_\-t Sensor\-Number)}\label{fsm_8c_a34b59de2fc1e23b5dcb24e9e5c9cfb08}

\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{fsm_8c_aa3943ee209a53bcd62d156b021762b4c}{uint8\-\_\-t {\bfseries Same\-Group\-I\-Ds} \mbox{[}127\mbox{]}}\label{fsm_8c_aa3943ee209a53bcd62d156b021762b4c}

\item 
\hypertarget{fsm_8c_aff2cb92f0f7567d50645f5bc33e0c60c}{int16\-\_\-t {\bfseries T\-W\-I\-Watchdog\-Timer} = 0}\label{fsm_8c_aff2cb92f0f7567d50645f5bc33e0c60c}

\item 
\hypertarget{fsm_8c_a37799ac9eeb22510b02859242d5f16d1}{volatile uint8\-\_\-t {\bfseries Current\-Group} = 0}\label{fsm_8c_a37799ac9eeb22510b02859242d5f16d1}

\item 
\hypertarget{fsm_8c_a671d38ebf3542cd8eca5f72d7459694b}{volatile uint16\-\_\-t {\bfseries ticks}}\label{fsm_8c_a671d38ebf3542cd8eca5f72d7459694b}

\item 
\hypertarget{fsm_8c_a8711919036a8d8abb73341cb5dcc98d0}{volatile uint8\-\_\-t {\bfseries T\-C\-Timing\-Flags}}\label{fsm_8c_a8711919036a8d8abb73341cb5dcc98d0}

\item 
\hypertarget{fsm_8c_a9b9648b0d6028cfce122aabac7fe9134}{volatile uint8\-\_\-t {\bfseries Next\-Sensor}}\label{fsm_8c_a9b9648b0d6028cfce122aabac7fe9134}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
System F\-S\-M services Source file. Created\-: 5/9/2014 9\-:53\-:52 P\-M Author\-: dikan / Panayiotou Konstantinos Email\-: \href{mailto:glagloui@gmail.com}{\tt glagloui@gmail.\-com} 

\subsection{Function Documentation}
\hypertarget{fsm_8c_a05b49f5eb1da9dd701624310ae83e520}{\index{fsm.\-c@{fsm.\-c}!Create\-Array\-Same\-Group\-I\-Ds@{Create\-Array\-Same\-Group\-I\-Ds}}
\index{Create\-Array\-Same\-Group\-I\-Ds@{Create\-Array\-Same\-Group\-I\-Ds}!fsm.c@{fsm.\-c}}
\subsubsection[{Create\-Array\-Same\-Group\-I\-Ds}]{\setlength{\rightskip}{0pt plus 5cm}void Create\-Array\-Same\-Group\-I\-Ds (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{fsm_8c_a05b49f5eb1da9dd701624310ae83e520}
$<$Brief function description \begin{DoxyVerb}   Create an array with the IDs of sensors that belong in CurrentGroup (this group will begin measurements) 
   and clear 'Used' flag of Sensors in this group.\end{DoxyVerb}
 Brief function description \begin{DoxyVerb}   Select next available sensor to be serviced on I2C bus.\end{DoxyVerb}
 \hypertarget{fsm_8c_ac6c8493b0fea9a14fdba8a3473d7cc12}{\index{fsm.\-c@{fsm.\-c}!I2\-C\-Sensor\-F\-S\-M\-Core@{I2\-C\-Sensor\-F\-S\-M\-Core}}
\index{I2\-C\-Sensor\-F\-S\-M\-Core@{I2\-C\-Sensor\-F\-S\-M\-Core}!fsm.c@{fsm.\-c}}
\subsubsection[{I2\-C\-Sensor\-F\-S\-M\-Core}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t I2\-C\-Sensor\-F\-S\-M\-Core (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8c_ac6c8493b0fea9a14fdba8a3473d7cc12}
$<$ Brief function description \begin{DoxyVerb}   FSM core for I2C communications.
   Lasts 15usec MAX.\end{DoxyVerb}
 Brief function description \begin{DoxyVerb}   SRF05 Sonars Service FSM.\end{DoxyVerb}
 \hypertarget{fsm_8c_ad040d5fa41e6f301ac09295e9cf7aaef}{\index{fsm.\-c@{fsm.\-c}!Sensor\-Wait\-Time\-Handler@{Sensor\-Wait\-Time\-Handler}}
\index{Sensor\-Wait\-Time\-Handler@{Sensor\-Wait\-Time\-Handler}!fsm.c@{fsm.\-c}}
\subsubsection[{Sensor\-Wait\-Time\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}void Sensor\-Wait\-Time\-Handler (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{fsm_8c_ad040d5fa41e6f301ac09295e9cf7aaef}
Brief function description \begin{DoxyVerb}   Sets I2C sensor in revive state and resets I2C bus.
   Increases Communication Errors counter for the specific sensor.
   Punish that sensor on a wait state.\end{DoxyVerb}
 \hypertarget{fsm_8c_adbf215cc37ab53e94b251cb02ce51293}{\index{fsm.\-c@{fsm.\-c}!Set\-Sensor\-In\-Revive\-State@{Set\-Sensor\-In\-Revive\-State}}
\index{Set\-Sensor\-In\-Revive\-State@{Set\-Sensor\-In\-Revive\-State}!fsm.c@{fsm.\-c}}
\subsubsection[{Set\-Sensor\-In\-Revive\-State}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t Set\-Sensor\-In\-Revive\-State (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8c_adbf215cc37ab53e94b251cb02ce51293}
Brief function description \begin{DoxyVerb}   Check if all sensors in "CurrentGroup" ended measuring or are in revive state. 
   If true, initialize next group to be serviced.\end{DoxyVerb}
 \hypertarget{fsm_8c_a35558d664e075ee8731ff9268d8f8b6d}{\index{fsm.\-c@{fsm.\-c}!S\-R\-F05tiny\-F\-S\-M@{S\-R\-F05tiny\-F\-S\-M}}
\index{S\-R\-F05tiny\-F\-S\-M@{S\-R\-F05tiny\-F\-S\-M}!fsm.c@{fsm.\-c}}
\subsubsection[{S\-R\-F05tiny\-F\-S\-M}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t S\-R\-F05tiny\-F\-S\-M (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8c_a35558d664e075ee8731ff9268d8f8b6d}
Brief function description \begin{DoxyVerb}   Two Wire Interface (I2C) software watchdog.\end{DoxyVerb}
 \hypertarget{fsm_8c_a22e3e2f52a53eff2ec1465883753db1d}{\index{fsm.\-c@{fsm.\-c}!T\-W\-I\-Result\-Handler@{T\-W\-I\-Result\-Handler}}
\index{T\-W\-I\-Result\-Handler@{T\-W\-I\-Result\-Handler}!fsm.c@{fsm.\-c}}
\subsubsection[{T\-W\-I\-Result\-Handler}]{\setlength{\rightskip}{0pt plus 5cm}uint8\-\_\-t T\-W\-I\-Result\-Handler (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8c_a22e3e2f52a53eff2ec1465883753db1d}
Brief function description \begin{DoxyVerb}   Handle waiting time for "punished" sensors on I2C bus
   Decrease WaitCount1/ComRepeats/TimeForNextCycle if !0 \end{DoxyVerb}
 \hypertarget{fsm_8c_a0fcf5e90554fb79bfa792eb110ed1fe1}{\index{fsm.\-c@{fsm.\-c}!Wait\-I2\-C\-Status@{Wait\-I2\-C\-Status}}
\index{Wait\-I2\-C\-Status@{Wait\-I2\-C\-Status}!fsm.c@{fsm.\-c}}
\subsubsection[{Wait\-I2\-C\-Status}]{\setlength{\rightskip}{0pt plus 5cm}void Wait\-I2\-C\-Status (
\begin{DoxyParamCaption}
\item[{uint8\-\_\-t}]{Sensor\-Number}
\end{DoxyParamCaption}
)}}\label{fsm_8c_a0fcf5e90554fb79bfa792eb110ed1fe1}
Brief function description \begin{DoxyVerb}   I2C bus results handler. Checks for bus errors and data transmission errors.\end{DoxyVerb}
 